# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file creates filebeat shippers for live and archived NetFlow source data

- type: netflow
  host: "0.0.0.0:9995"
  protocols: [ v5, v9, ipfix ]
  fields_under_root: true
  fields:
    type: netflow

- type: filestream
  id: nfarch-01
  paths:
    - /logstash/nfarch/**
  exclude_files: [ 'readme.txt', \.gz$', '\.bz2$', '\.zip$', '\.json$' ]
  close.on_state_change.inactive: 5m
  clean_removed: true
  fields_under_root: true
  fields:
    type: archive-netflow

- type: filestream
  id: nfarch-json
  paths:
    - /logstash/nfarch/**/*.json
  close.on_state_change.inactive: 5m
  clean_removed: true
  fields_under_root: true
  parsers:
    - multiline:
        type: pattern
        pattern: "(?:^ *{$|^]$)"
        negate: true
        match: after
  # exclude_lines takes place AFTER the multiline processing
  # this line will drop the start/end of the array
  exclude_lines: [ "^\\[$", "^\\]$" ]
  fields:
    type: archive-netflow
  tags: [ 'json' ]
