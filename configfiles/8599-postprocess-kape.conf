# SOF-ELKÂ® Configuration File
# (C)2024 Lewes Technology Consulting, LLC
#
# This file contains postprocessing for logs parsed with the KAPE forensic tool

filter {
  if [labels][type] =~ /^kape_/ {

    # convert file.attributes to an array
    if [file][attributes] {
      ruby {
        path => "/usr/local/sof-elk/supporting-scripts/ntfs_flags_to_array.rb"
        script_params => {
          "source_field" => "[file][attributes]"
          "source_type" => "[@metadata][attribute_type]"
        }
        remove_field => [ "[@metadata][attribute_type]" ]
      }
    }

    # clean up the record
    mutate {
      remove_field => [ "raw" ]
    }
  }
}
