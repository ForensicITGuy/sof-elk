# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file contains filters, transforms, and enrichments for BIND query log messages

filter {
  # dns query log messages
  if [type] == "syslog" and [log][syslog][appname] == "named" and [message] =~ / query: / {
    grok {
      match => [ "message", "client %{IP:[source][ip]}#%{POSINT}: query: %{HOSTNAME:[dns][question][name]} %{NOTSPACE} %{NOTSPACE:[dns][question][type]}" ]
      add_tag => [ "parse_done" ]
      tag_on_failure => [ "_gpfail", "fail_sl10" ]
    }

    if [source][ip] and [dns][question][name] {
      mutate {
        replace => { "message" => "DNS Query: %{[source][ip]} (%{[dns][question][name]})" }
      }
    }
  }
}
