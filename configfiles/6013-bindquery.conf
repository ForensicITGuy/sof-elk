# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file contains filters, transforms, and enrichments for BIND query log messages

filter {
  # dns query log messages
  if [type] == "syslog" and [log][syslog][appname] == "named" and [message] =~ / query: / {
    grok {
      match => [ "message", "client %{IP:source.ip}#%{POSINT}: query: %{HOSTNAME:dns_query} %{NOTSPACE} %{NOTSPACE:dns_rectype}" ]
      add_tag => [ "parse_done" ]
      tag_on_failure => [ "_gpfail", "fail_sl10" ]
    }

    if [source][ip] and [dns_query] {
      mutate {
        replace => { "message" => "DNS Query: %{[source][ip]} (%{dns_query})" }
      }
    }
  }
}
